brain:
  # Select the main intelligence unit (Director).
  # Uses CLI tools instead of API calls for unstructured mission interpretation and command generation.
  # If no driver block is present, NightShift default presets are used.
  active_driver: "claude" # options: claude, codex, gemini, deepseek, qwen, llama
  output_format: "json" # text | json
  # Codex CLI specific approval/sandbox options (optional)
  approval: "on-request" # untrusted | on-failure | on-request | never
  sandbox: "read-only" # read-only | workspace-write | danger-full-access
  home_dir: ".night_shift/brain_env"
  link_auth: true

  deepseek:
    # DeepSeek Coder via Ollama (Requires 'ollama' installed)
    # Recommended models: deepseek-r1:14b (for 16GB+ RAM), deepseek-r1:8b (for 8GB RAM)
    command: "ollama"
    args:
      - "run"
      - "deepseek-r1:14b" 
      - "{prompt}"
  qwen:
    # Qwen 2.5 via Ollama (Requires 'ollama' installed)
    # Recommended: qwen2.5:14b (Great at JSON & Coding), qwen2.5:7b
    command: "ollama"
    args:
      - "run"
      - "qwen2.5:14b"
      - "{prompt}"
  llama:
    # Llama 3.1 via Ollama (Requires 'ollama' installed)
    # Recommended: llama3.1 (8B) - Fast and stable standard
    command: "ollama"
    args:
      - "run"
      - "llama3.1"
      - "{prompt}"
  claude:
    # Claude Code CLI (requires 'claude' in PATH)
    command: "claude"
    args:
      - "-p"
      - "{prompt}"
      - "--dangerously-skip-permissions"
  codex:
    # OpenAI Codex CLI (@openai/codex)
    command: "codex"
    args:
      - "exec"
      - "--full-auto"
      - "{prompt}"
  gemini:
    # Gemini CLI (Official/Community)
    command: "gemini"
    args:
      - "-p"
      - "{prompt}"

body:
  # Select the execution unit (Worker/Hassan).
  active_driver: "codex"
  use_real_home: true
  # Codex CLI specific approval/sandbox options (optional)
  approval: "on-request"
  sandbox: "workspace-write"
  deepseek:
    # DeepSeek Coder via Ollama (Requires 'ollama' installed)
    command: "ollama"
    # {query} will be replaced with the actual command
    # Note: System prompts are handled differently in Ollama CLI (often prepended to query)
    args:
      - "run"
      - "deepseek-r1:14b"
      - "You are Hassan, an expert developer. Execute the following task:\n\n{query}"
  qwen:
    # Qwen 2.5 via Ollama
    command: "ollama"
    args:
      - "run"
      - "qwen2.5:14b"
      - "You are Hassan, an expert developer. Execute the following task:\n\n{query}"
  llama:
    # Llama 3.1 via Ollama
    command: "ollama"
    args:
      - "run"
      - "llama3.1"
      - "You are Hassan, an expert developer. Execute the following task:\n\n{query}"
  claude:
    # Claude Code CLI (requires 'claude' in PATH)
  gemini:
    # Gemini CLI (Official/Community)
    command: "gemini"
    args:
      - "-p"
      - "{query}"
      - "--allowed-tools"
      - "write_file"
      - "--allowed-tools"
      - "run_shell_command"
  codex:
    # OpenAI Codex CLI (@openai/codex)
    command: "codex"
    args:
      - "exec"
      - "--dangerously-bypass-approvals-and-sandbox"
      - "{query}"

# Safety & Snapshot Settings
safety:
  # Automatically rollback to the previous commit if a task fails
  auto_rollback_on_failure: false
  # Create a temporary backup branch before starting the mission
  create_backup_branch: false
  # Automatically commit and push after all tasks complete
  auto_commit_and_push: false
  # Require approval for destructive commands (rm -rf, git reset, etc.)
  require_approval_for_destructive: true
  # Run tasks in a worktree and preview changes before applying
  preview_changes: false
  # Use git worktrees for task isolation when possible
  use_worktrees: false

# Tool registry shared with Brain/Hassan (optional)
tools:
  - "view <path_or_url>: Read a local file or fetch and clean a web URL."
  - "list <path>: List files in a directory with icons."
  - "edit <path> <old_text> <new_text>: Safely replace exact text in a file."
  - "run_shell_command <command>: Execute any standard shell command."
  - "rg -n <pattern> <path>"
  - "python3 night_shift.py --dry-run"

# Planner (optional)
planner:
  enabled: true
  require_approval: true

# QA (optional)
qa:
  run_tests: false
  test_on_each_task: true
  test_command: ""

# Memory (optional)
memory:
  scope: "project" # project | global | both

# Parallel execution (optional)
parallel:
  max_workers: 4
  use_worktrees: false

# Resume (optional)
resume: true

# Context reduction (optional)
context_reduction:
  enabled: true
  head_chars: 800
  tail_chars: 2000

# Message Efficiency Mode (optional)
# If true, excludes detailed persona guidelines from the system prompt to save tokens.
message_efficiency: true

# Persona Definitions: Professional guidelines shared by Brain and Hassan
personas:
  architect: |
    - Focus on high-level structure, scalability, and design patterns (SOLID, Clean Architecture).
    - Avoid quick hacks; prioritize maintainability.
    - Ensure all components are modular and well-interfaced.
    - Prefer clear boundaries, minimal coupling, and stable interfaces.

  troubleshoot: |
    - Prioritize root cause analysis (RCA).
    - Always analyze logs, tracebacks, and environment state before proposing a fix.
    - Explain the logic behind the fix and verify it with tests.
    - Prefer minimal, targeted changes with evidence-backed reasoning.

  document: |
    - Write professional, clear, and concise technical documentation.
    - Ensure READMEs, API docs, and code comments follow standard conventions.
    - Focus on the "Why" and "How to use" rather than just the "What".
    - Provide quickstart steps and concrete examples when helpful.

  brainstorm: |
    - Generate creative ideas, alternative approaches, and innovative solutions.
    - Focus on divergent thinking and explore multiple possibilities without self-censoring.
    - Provide pros and cons for each major idea.
    - Avoid converging too early; keep options open.

  research: |
    - Conduct deep-dive investigations, search for best practices, and gather relevant data.
    - Focus on finding external documentation, library APIs, and community-proven solutions.
    - Summarize findings with clear sources and actionable insights.
    - Prefer primary sources and official docs when possible.

  analyze: |
    - Perform rigorous problem analysis and identify root causes (RCA).
    - Deconstruct complex issues into smaller, manageable parts.
    - Focus on logic, data evidence, and systematic troubleshooting.
    - Validate assumptions and make constraints explicit.

  general: |
    - Act as a balanced, professional software engineer.
    - Focus on delivering functional, clean, and tested code.
    - Keep changes small, readable, and well-justified.

  security: |
    - Prioritize threat modeling, least privilege, and secure defaults.
    - Avoid introducing risky dependencies or unsafe patterns.
    - Flag sensitive data exposure and secret handling issues.
    - Prefer explicit validation and safe error handling.

  performance: |
    - Identify bottlenecks with evidence (profiling/logs) before tuning.
    - Focus on algorithmic improvements and reducing I/O.
    - Avoid premature optimization; measure impact.
    - Document tradeoffs and performance assumptions.

  testing: |
    - Add or improve tests for critical paths and regressions.
    - Prefer deterministic, fast, and isolated tests.
    - Validate edge cases and failure modes.
    - Keep test names and assertions clear and specific.

  ops: |
    - Emphasize deployment reliability, observability, and rollback plans.
    - Prefer explicit configuration and reproducible environments.
    - Improve logging, metrics, and alerting where relevant.
    - Consider operational runbooks and failure recovery.

  researcher: |
    - Gather evidence from docs, specs, and reliable sources.
    - Summarize findings with citations and clear recommendations.
    - Compare alternatives and note risks or unknowns.

  refactor: |
    - Reduce complexity and improve readability without changing behavior.
    - Prefer small, safe steps with tests or verification.
    - Eliminate duplication and clarify responsibilities.
    - Keep public APIs stable unless explicitly required.

  ux_writer: |
    - Focus on clarity, tone, and user empathy.
    - Use concise language and consistent terminology.
    - Provide helpful microcopy and actionable guidance.
    - Avoid jargon unless it is clearly defined.

# MCP Servers (optional)
# Connects to external Model Context Protocol servers to provide dynamic tools.
mcp_servers:
  serena:
    command: "uvx"
    args: ["--from", "git+https://github.com/oraios/serena.git", "serena", "start-mcp-server"]
    enabled: true
  sequential_thinking:
    command: "npx"
    args: ["-y", "@modelcontextprotocol/server-sequential-thinking"]
    enabled: true
  context7:
    command: "npx"
    args: ["-y", "@upstash/context7-mcp@latest"]
    enabled: true

# Optional: automatic persona selection rules (first match wins).
# flags: "i" enables case-insensitive matching.
persona_rules:
  - pattern: "docs|readme|document"
    persona: "document"
    flags: "i"
  - pattern: "bug|error|traceback|fix"
    persona: "troubleshoot"
    flags: "i"
