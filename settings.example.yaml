# Night Shift Configuration Example
# Copy this to settings.yaml and adjust as needed.

# --- Brain (The Director) ---
# Decides strictly what to do next.
brain:
  active_driver: claude  # claude, gemini, codex, etc.
  output_format: json    # json (recommended) or text
  timeout: 300           # Seconds to wait for Brain response

# --- Hassan (The Executor) ---
# Executes the commands.
hassan:
  active_driver: claude
  # active_driver: codex  # Uncomment to use OpenAI Codex (requires CLI)
  timeout: 600
  # If true, Hassan uses the real system HOME directory instead of an isolated one.
  # Useful for tools like 'claude' that depend on local config, but less safe.
  use_real_home: false

# --- Critic (The QA) ---
# Validates the work.
critic:
  enabled: true
  active_drivers: [gemini] # Can use multiple critics for voting
  voting: majority         # all (unanimous) or majority
  timeout: 300

# --- Memory ---
memory:
  scope: project # project, global, or both

# --- Context Reduction ---
context_reduction:
  enabled: true
  head_chars: 800
  tail_chars: 2000

# --- Safety ---
safety:
  auto_rollback_on_failure: true
  create_backup_branch: true
  require_approval_for_destructive: true
  preview_changes: false # If true, uses worktrees to preview changes before applying
  auto_commit_and_push: false

# --- Persona Rules (Auto-Selection) ---
# If mission.yaml doesn't specify a persona, these regex rules allow
# NightShift to auto-select the best expert based on the task description.
# Checked in order (top to bottom).
persona_rules:
  # 1. Architecture & Infrastructure
  - pattern: "(?i)(devops|docker|kubernetes|k8s|pipeline|ci/cd|deploy|aws|cloud|terraform|ansible)"
    persona: "devops-architect"
  - pattern: "(?i)(frontend|ui|ux|css|html|react|vue|tailwind|accessibility|wcag|web vitals)"
    persona: "frontend-architect"
  - pattern: "(?i)(backend|api|database|schema|sql|graphql|rest|server|microservice)"
    persona: "backend-architect"
  - pattern: "(?i)(system design|architecture|scalability|pattern|structure)"
    persona: "system-architect"

  # 2. Quality & Security
  - pattern: "(?i)(security|auth|oauth|vulnerability|hack|owasp|audit|penetration)"
    persona: "security-engineer"
  - pattern: "(?i)(performance|optimize|speed|latency|slow|benchmark|memory leak|cpu)"
    persona: "performance-engineer"
  - pattern: "(?i)(test|qa|coverage|unit test|integration test|e2e|mock|fixture)"
    persona: "quality-engineer"
  - pattern: "(?i)(refactor|cleanup|clean code|technical debt|legacy|simplify)"
    persona: "refactoring-expert"

  # 3. Research & Analysis
  - pattern: "(?i)(research|investigate|find out|search|study|compare|survey)"
    persona: "deep-research-agent"
  - pattern: "(?i)(requirement|prd|spec|user story|planning|scope|analysis)"
    persona: "requirements-analyst"
  - pattern: "(?i)(index|map|overview|structure|codebase)"
    persona: "repo-index"

  # 4. Troubleshooting & Maintenance
  - pattern: "(?i)(bug|fix|error|exception|fail|crash|debug|root cause|incident)"
    persona: "root-cause-analyst"
  - pattern: "(?i)(doc|readme|guide|manual|tutorial|write up|changelog)"
    persona: "technical-writer"

  # 5. Language Specifics (Examples)
  - pattern: "(?i)(python|pip|django|flask|fastapi|pandas|numpy)"
    persona: "python-expert"

# --- Tools ---
# Tools available to the agents. (Actual tool logic is handled by the CLI driver)
tools:
  - "ls: List files"
  - "cat: Read file content"
  - "grep: Search text in files"
  - "find: Find files"
  - "edit: Edit file (via sed or specialized tool)"
  - "run_test: Run test suite"
  - "git: Version control"
